# MCP Playwright Test

基于 Model Context Protocol (MCP)的 Playwright 测试自动化服务器。

## 功能特点

- 自动获取项目代码(支持 Git 仓库或本地项目)
- 使用 Playwright 设置测试环境
- 基于需求生成测试用例
- 执行 UI 和 API 测试并生成详细报告
- 捕获并分析网络请求和控制台日志

## 快速开始

### 安装

```bash
# 使用npm
npm install mcp-playwright-test

# 或使用yarn
yarn add mcp-playwright-test

# 或使用pnpm
pnpm add mcp-playwright-test
```

### 配置环境变量

```bash
# 用于生成测试用例的Anthropic API密钥
export ANTHROPIC_API_KEY=your_api_key_here

# 可选：服务器端口(默认8931)
export MCP_PORT=8931
```

### 启动服务器

```bash
# 使用npm脚本启动
npm run start

# 或者直接运行
npx ts-node src/test-mcp.ts
```

## 配置文件说明

MCP Playwright Test 支持通过`.playwright-mcp.json`文件进行配置，特别适合在 Claude Desktop 和 Cursor 等 AI 工具环境中使用。

### 配置文件示例

```json
{
  "mcpServers": {
    "mcp-server-alipay": {
      "command": "npx",
      "args": ["-y", "mcp-playwright-test"],
      "env": {
        "CODE_PATH": ".",
        "SIMPLE_GIT_PATH": "git",
        "SIMPLE_GIT_BRANCH": "main",
        "SIMPLE_GIT_DEPTH": 1,
        "SIMPLE_GIT_USERNAME": "username",
        "SIMPLE_GIT_PASSWORD": "password",
        "API_URL": "http://localhost:3000",
        "API_KEY": "your-api-key"
      }
    }
  }
}
```

### Claude Desktop 和 Cursor 配置

1. **在 Claude Desktop 中使用**:

   - 在项目根目录创建`.playwright-mcp.json`文件
   - 在 Claude Desktop 设置中添加服务器配置指向该文件
   - 使用"自定义 MCP 服务器"选项，选择"mcp-server-alipay"

2. **在 Cursor 中使用**:
   - 确保项目中存在`.playwright-mcp.json`文件
   - 在 Cursor 的 MCP 配置中选择"使用本地 MCP 服务器"
   - 指定服务器名称为"mcp-server-alipay"

### 环境变量说明

| 变量名              | 说明               | 默认值                |
| ------------------- | ------------------ | --------------------- |
| CODE_PATH           | 代码路径           | .                     |
| SIMPLE_GIT_PATH     | Git 可执行文件路径 | git                   |
| SIMPLE_GIT_BRANCH   | 克隆时使用的分支   | -                     |
| SIMPLE_GIT_DEPTH    | 克隆深度           | -                     |
| SIMPLE_GIT_USERNAME | Git 用户名         | -                     |
| SIMPLE_GIT_PASSWORD | Git 密码或令牌     | -                     |
| API_URL             | API 基础 URL       | http://localhost:3000 |
| API_KEY             | API 密钥           | -                     |
| BROWSER_TYPE        | 浏览器类型         | chromium              |
| BROWSER_HEADLESS    | 是否使用无头模式   | true                  |
| TEST_STORAGE_DIR    | 测试结果存储目录   | ./test-results        |

## 可用工具

MCP 服务器提供以下工具：

- `clone-repository`: 克隆 Git 仓库进行测试
- `use-local-project`: 使用本地项目进行测试
- `launch-browser`: 启动浏览器进行测试
- `generate-tests-from-text`: 从文本需求生成测试用例
- `generate-tests-from-document`: 从文档生成测试用例
- `run-tests`: 运行测试套件
- `api-test`: 生成并运行 API 测试

## 可用资源

MCP 服务器提供以下资源：

- `reports`: 获取测试执行报告
- `test-cases`: 检索测试用例

## 开发

### 安装依赖

```bash
pnpm install
```

### 构建项目

```bash
pnpm build
```

### 运行测试

```bash
pnpm test
```

## 许可证

MIT
