# Playwright MCP Test SDK

基于 GitHub 的开源 Chrome Debug MCP Playwright 和微软的 Playwright MCP 实现的 TypeScript 测试 SDK，用于自动化前端测试。

## 功能特点

- 支持从 Git 仓库或本地路径获取前端项目代码
- 自动启动和控制前端项目的浏览器测试
- 根据需求文档或自然语言输入自动生成测试用例
- 在 Playwright 中执行测试，同时捕获网络请求和控制台信息
- 生成详细的错误报告，包括前端错误位置和后端 API 错误信息

## 安装

```bash
npm install playwright-test-mcp
```

## 基本用法

```typescript
import PlaywrightMCPTestSDK from "playwright-test-mcp";

async function main() {
  // 创建SDK实例
  const sdk = new PlaywrightMCPTestSDK({
    browserOptions: {
      headless: false,
      browserType: "chromium",
    },
  });

  try {
    // 使用本地项目或从Git克隆
    await sdk.useLocalProject("./my-frontend-project");
    // 或者
    // await sdk.cloneRepository('https://github.com/user/repo.git', {
    //   username: 'user',
    //   password: 'pass'
    // });

    // 启动前端项目
    await sdk.startFrontendProject();

    // 启动浏览器
    await sdk.launchBrowser();

    // 从需求生成测试用例
    const testCases = await sdk.generateTestsFromRequirements(`
      1. 用户应该能够使用有效凭证登录
      2. 用户应该能够搜索产品
      3. 用户应该能够将产品添加到购物车
    `);

    // 运行测试
    const results = await sdk.runTests(testCases);

    // 生成错误报告
    const report = await sdk.generateErrorReport();
    await sdk.saveErrorReport(report, "./reports");

    console.log(`测试完成: ${results.passed ? "通过" : "失败"}`);
  } finally {
    // 清理资源
    await sdk.close();
  }
}

main().catch(console.error);
```

## API 参考

### PlaywrightMCPTestSDK

主 SDK 类，提供所有功能的入口点。

#### 构造函数

```typescript
new PlaywrightMCPTestSDK(options?: SDKOptions)
```

#### 主要方法

- `configure(options: SDKOptions)`: 配置 SDK 选项
- `cloneRepository(url: string, credentials?: GitCredentials)`: 从 Git 克隆代码
- `useLocalProject(path: string)`: 使用本地项目路径
- `launchBrowser(options?: BrowserOptions)`: 启动浏览器
- `setupMCPServer()`: 设置 MCP 服务器
- `startFrontendProject()`: 启动前端项目
- `generateTestsFromRequirements(text: string)`: 从文本生成测试用例
- `generateTestsFromDocument(path: string)`: 从文档生成测试用例
- `runTests(testCases: TestCase[])`: 运行测试用例
- `captureNetworkRequests()`: 获取网络请求
- `captureConsoleMessages()`: 获取控制台消息
- `generateErrorReport()`: 生成错误报告
- `saveErrorReport(report: ErrorReport, path?: string)`: 保存错误报告
- `generateTestScript(path: string)`: 生成 Playwright 测试脚本
- `close()`: 清理资源

## 配置选项

SDK 接受以下配置选项：

```typescript
interface SDKOptions {
  gitOptions?: {
    credentials?: { username?: string; password?: string; sshKey?: string };
    branch?: string;
    depth?: number;
  };
  browserOptions?: {
    browserType?: "chromium" | "firefox" | "webkit";
    headless?: boolean;
    slowMo?: number;
    viewport?: { width: number; height: number };
    userAgent?: string;
  };
  mcpOptions?: {
    port?: number;
    visionMode?: boolean;
    transport?: "http" | "sse" | "ws";
  };
  testGenerationOptions?: {
    promptTemplate?: string;
    maxTestCases?: number;
    includeScreenshots?: boolean;
    screenshotOnFailure?: boolean;
  };
  reportingOptions?: {
    outputFormat?: "json" | "html" | "markdown";
    outputPath?: string;
    includeScreenshots?: boolean;
    includeConsoleMessages?: boolean;
    includeNetworkRequests?: boolean;
  };
  apiTestingOptions?: {
    baseUrl?: string;
    timeout?: number;
    headers?: Record<string, string>;
    enableMocking?: boolean;
    mockPort?: number;
    specPath?: string;
  };
}
```

## API Testing

除了前端的 UI 测试，SDK 还支持 API 测试功能：

```typescript
// 创建SDK实例
const sdk = new PlaywrightMCPTestSDK({
  apiTestingOptions: {
    baseUrl: "https://api.example.com",
    headers: {
      "Content-Type": "application/json",
    },
  },
});

// 定义API测试用例
const apiTestCases = [
  {
    id: "get-user",
    description: "获取用户信息",
    endpoint: "/users/1",
    method: "GET",
    assertions: [
      { type: "status", target: "status", operator: "=", value: 200 },
      { type: "body", target: "name", operator: "contains", value: "John" },
    ],
  },
];

// 运行API测试
const results = await sdk.runAPITests(apiTestCases);

// 生成报告
const errorReport = await sdk.generateAPIErrorReport();
await sdk.saveErrorReport(errorReport);
```

API 测试功能还支持：

- 从 OpenAPI 规范自动生成测试用例: `generateAPITestsFromSpec()`
- API 响应模拟: `mockAPIEndpoint()`, `startMockServer()`
- 丰富的断言类型: 状态码、响应头、响应体

查看 [examples/api-testing-example.ts](./examples/api-testing-example.ts) 获取更多详细示例。

## 许可证

MIT
